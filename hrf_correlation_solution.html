<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Predicted neural time course exercise &#8212; Functional MRI methods</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/copybutton.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Functional MRI methods" href="index.html" />
    <link rel="next" title="Using onsets that do not start on a TR" href="non_tr_onsets.html" />
    <link rel="prev" title="Predicted neural time course exercise" href="hrf_correlation_exercise.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <p><span class="math">\(\newcommand{L}[1]{\| #1 \|}\newcommand{VL}[1]{\L{ \vec{#1} }}\newcommand{R}[1]{\operatorname{Re}\,(#1)}\newcommand{I}[1]{\operatorname{Im}\, (#1)}\)</span></p>
<div class="section" id="predicted-neural-time-course-exercise">
<h1>Predicted neural time course exercise<a class="headerlink" href="#predicted-neural-time-course-exercise" title="Permalink to this headline">Â¶</a></h1>
<div class="nbplot container">
</div>
<div class="nbplot container">
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#: Standard imports</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Print arrays to 4 decimal places</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We are going to be analyzing the data for the 4D image
<a class="reference download internal" href="_downloads/ds114_sub009_t2r1.nii" download=""><code class="xref download docutils literal"><span class="pre">ds114_sub009_t2r1.nii</span></code></a> again.</p>
<p>Load the image into an image object with nibabel, and get the image data
array. Print the shape.</p>
<div class="nbplot container">
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#- Load the image with nibabel.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#- Get the image data array, print the data shape.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">nibabel</span> <span class="kn">as</span> <span class="nn">nib</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;ds114_sub009_t2r1.nii&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(64, 64, 30, 173)</span>
</pre></div>
</div>
</div>
<p>Next we read in the stimulus file for this run to make an on - off
time-series.</p>
<p>The stimulus file is <a class="reference download internal" href="_downloads/ds114_sub009_t2r1_cond.txt" download=""><code class="xref download docutils literal"><span class="pre">ds114_sub009_t2r1_cond.txt</span></code></a>.</p>
<p>Here&#8217;s a version of the same thing we did in <a class="reference internal" href="first_activation_exercise.html"><span class="doc">First go at brain activation exercise</span></a>,
wrapped up as a function:</p>
<div class="nbplot container">
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#: Read in stimulus file, return neural prediction</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">events2neural</span><span class="p">(</span><span class="n">task_fname</span><span class="p">,</span> <span class="n">tr</span><span class="p">,</span> <span class="n">n_trs</span><span class="p">):</span>
<span class="gp">... </span>    <span class="sd">&quot;&quot;&quot; Return predicted neural time course from event file</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    Parameters</span>
<span class="gp">... </span><span class="sd">    ----------</span>
<span class="gp">... </span><span class="sd">    task_fname : str</span>
<span class="gp">... </span><span class="sd">        Filename of event file</span>
<span class="gp">... </span><span class="sd">    tr : float</span>
<span class="gp">... </span><span class="sd">        TR in seconds</span>
<span class="gp">... </span><span class="sd">    n_trs : int</span>
<span class="gp">... </span><span class="sd">        Number of TRs in functional run</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    Returns</span>
<span class="gp">... </span><span class="sd">    -------</span>
<span class="gp">... </span><span class="sd">    time_course : array shape (n_trs,)</span>
<span class="gp">... </span><span class="sd">        Predicted neural time course, one value per TR</span>
<span class="gp">... </span><span class="sd">    &quot;&quot;&quot;</span>
<span class="gp">... </span>    <span class="n">task</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">task_fname</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">task</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Is {0} really a task file?&quot;</span><span class="p">,</span> <span class="n">task_fname</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">task</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">task</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">tr</span>
<span class="gp">... </span>    <span class="n">time_course</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_trs</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">onset</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">amplitude</span> <span class="ow">in</span> <span class="n">task</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">onset</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">onset</span><span class="p">),</span>  <span class="nb">int</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">time_course</span><span class="p">[</span><span class="n">onset</span><span class="p">:</span><span class="n">onset</span> <span class="o">+</span> <span class="n">duration</span><span class="p">]</span> <span class="o">=</span> <span class="n">amplitude</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">time_course</span>
</pre></div>
</div>
</div>
<p>Use this function to read <code class="docutils literal"><span class="pre">ds114_sub009_t2r1_cond.txt</span></code> and return a
predicted neural time course.</p>
<p>The TR for this run is 2.5. You know the number of TRs from the image
data shape above.</p>
<div class="nbplot container">
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#: TR for this run</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tr</span> <span class="o">=</span> <span class="mf">2.5</span>
</pre></div>
</div>
</div>
<div class="nbplot container">
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#- Read the stimulus data file and return a predicted neural time</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#- course.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#- Plot the predicted neural time course.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">neural_prediction</span> <span class="o">=</span> <span class="n">events2neural</span><span class="p">(</span><span class="s1">&#39;ds114_sub009_t2r1_cond.txt&#39;</span><span class="p">,</span> <span class="n">tr</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">neural_prediction</span><span class="p">)</span>
<span class="go">[...]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
<span class="go">(0, 1.2)</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//hrf_correlation_solution-6.png">png</a>, <a class="reference external" href=".//hrf_correlation_solution-6.hires.png">hires.png</a>, <a class="reference external" href=".//hrf_correlation_solution-6.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/hrf_correlation_solution-6.png" src="_images/hrf_correlation_solution-6.png" />
</div>
</div>
<p>We had previously found that the first volume in this run was bad. Use your
slicing skills to make a new array called <code class="docutils literal"><span class="pre">data_no_0</span></code> that is the data array
without the first volume:</p>
<div class="nbplot container">
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#- Make new array excluding the first volume</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#- data_no_0 = ?</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_no_0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>
</pre></div>
</div>
</div>
<p>Our neural prediction time series currently has one value per volume,
including the first volume. To match the data, make a new neural prediction
variable that does not include the first value of the time series. Call this
new variable <code class="docutils literal"><span class="pre">neural_prediction_no_0</span></code>.</p>
<div class="nbplot container">
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#- Knock the first element off the neural prediction time series.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#- neural_prediction_no_0 = ?</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">neural_prediction_no_0</span> <span class="o">=</span> <span class="n">neural_prediction</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</pre></div>
</div>
</div>
<p>For now, we&#8217;re going to play with data for a single voxel.</p>
<p>In <a class="reference internal" href="first_activation_exercise.html"><span class="doc">First go at brain activation exercise</span></a>, we subtracted the rest scans from the
task scans, something like this:</p>
<div class="nbplot container">
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#: subtracting rest from task scans</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">task_scans</span> <span class="o">=</span> <span class="n">data_no_0</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">neural_prediction_no_0</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rest_scans</span> <span class="o">=</span> <span class="n">data_no_0</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">neural_prediction_no_0</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">difference</span> <span class="o">=</span> <span class="n">task_scans</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">rest_scans</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbplot container">
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#: showing slice 14 from the difference image</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">difference</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">14</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="go">&lt;...&gt;</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//hrf_correlation_solution-10.png">png</a>, <a class="reference external" href=".//hrf_correlation_solution-10.hires.png">hires.png</a>, <a class="reference external" href=".//hrf_correlation_solution-10.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/hrf_correlation_solution-10.png" src="_images/hrf_correlation_solution-10.png" />
</div>
</div>
<p>It looks like there&#8217;s a voxel that is greater for activation than rest at
about (i, j, k) == (45, 43, 14).</p>
<p>Get and plot the values for this voxel position, for every volume in the 4D
data (not including the first volume). You can do it with a loop, but slicing
is much nicer.</p>
<div class="nbplot container">
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#- Get the values for (i, j, k) = (45, 43, 14) and every volume.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#- Plot the values (voxel time course).</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">voxel_values</span> <span class="o">=</span> <span class="n">data_no_0</span><span class="p">[</span><span class="mi">45</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="p">:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">voxel_values</span><span class="p">)</span>
<span class="go">[...]</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//hrf_correlation_solution-11.png">png</a>, <a class="reference external" href=".//hrf_correlation_solution-11.hires.png">hires.png</a>, <a class="reference external" href=".//hrf_correlation_solution-11.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/hrf_correlation_solution-11.png" src="_images/hrf_correlation_solution-11.png" />
</div>
</div>
<p>Correlate the predicted neural time series with the voxel time course:</p>
<div class="nbplot container">
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#- Correlation of predicted neural time course with voxel signal time</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#- course</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">neural_prediction_no_0</span><span class="p">,</span> <span class="n">voxel_values</span><span class="p">)</span>
<span class="go">array([[ 1.    ,  0.3117],</span>
<span class="go">       [ 0.3117,  1.    ]])</span>
</pre></div>
</div>
</div>
<p>Now we will do a predicted hemodynamic time course using convolution.</p>
<p>Next we need to get the HRF vector to convolve with.</p>
<p>Here is my not-that-good HRF definition.  Feel free to replace this one with
your better HRF definition from <a class="reference internal" href="make_an_hrf_exercise.html"><span class="doc">Making our own hemodynamic response function</span></a>:</p>
<div class="nbplot container">
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#: import the gamma probability density function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gamma</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">mt_hrf</span><span class="p">(</span><span class="n">times</span><span class="p">):</span>
<span class="gp">... </span>    <span class="sd">&quot;&quot;&quot; Return values for HRF at given times</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    This is the &quot;not_great_hrf&quot; from the &quot;make_an_hrf&quot; exercise.</span>
<span class="gp">... </span><span class="sd">    Feel free to replace this function with your improved version from</span>
<span class="gp">... </span><span class="sd">    that exercise.</span>
<span class="gp">... </span><span class="sd">    &quot;&quot;&quot;</span>
<span class="gp">... </span>    <span class="c1"># Gamma pdf for the peak</span>
<span class="gp">... </span>    <span class="n">peak_values</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="gp">... </span>    <span class="c1"># Gamma pdf for the undershoot</span>
<span class="gp">... </span>    <span class="n">undershoot_values</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="gp">... </span>    <span class="c1"># Combine them</span>
<span class="gp">... </span>    <span class="n">values</span> <span class="o">=</span> <span class="n">peak_values</span> <span class="o">-</span> <span class="mf">0.35</span> <span class="o">*</span> <span class="n">undershoot_values</span>
<span class="gp">... </span>    <span class="c1"># Scale max to 0.6</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">values</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.6</span>
</pre></div>
</div>
</div>
<p>Remember we have defined the HRF as a function of time, not TRs.</p>
<p>For our convolution, we need to <em>sample</em> the HRF at times corresponding the
start of the TRs.</p>
<p>So, we need to sample at times (0, 2.5, ...)</p>
<p>Make a vector of times at which to sample the HRF. We want to sample every TR
up until (but not including) somewhere near 35 seconds (where the HRF should
have got close to zero again).</p>
<div class="nbplot container">
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#- Make a vector of times at which to sample the HRF</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hrf_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="n">tr</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hrf_times</span>
<span class="go">array([  0. ,   2.5,   5. ,   7.5,  10. ,  12.5,  15. ,  17.5,  20. ,</span>
<span class="go">        22.5,  25. ,  27.5,  30. ,  32.5])</span>
</pre></div>
</div>
</div>
<p>Sample your HRF function at these times and plot:</p>
<div class="nbplot container">
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#- Sample HRF at given times</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#- Plot HRF samples against times</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hrf_signal</span> <span class="o">=</span> <span class="n">mt_hrf</span><span class="p">(</span><span class="n">hrf_times</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hrf_times</span><span class="p">,</span> <span class="n">hrf_signal</span><span class="p">)</span>
<span class="go">[...]</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//hrf_correlation_solution-15.png">png</a>, <a class="reference external" href=".//hrf_correlation_solution-15.hires.png">hires.png</a>, <a class="reference external" href=".//hrf_correlation_solution-15.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/hrf_correlation_solution-15.png" src="_images/hrf_correlation_solution-15.png" />
</div>
</div>
<p>Convolve the predicted neural time course with the HRF samples:</p>
<div class="nbplot container">
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#- Convolve predicted neural time course with HRF samples</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hemodynamic_prediction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">neural_prediction_no_0</span><span class="p">,</span> <span class="n">hrf_signal</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The default output of convolve is longer than the input neural prediction
vector, by the length of the convolving vector (the HRF samples) minus 1.
Knock these last values off the result of the convolution to get a vector the
same length as the neural prediction:</p>
<div class="nbplot container">
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#- Remove extra tail of values put there by the convolution</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hemodynamic_prediction</span> <span class="o">=</span> <span class="n">hemodynamic_prediction</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">neural_prediction_no_0</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<p>Plot the convolved neural prediction, and then, on the same plot, plot the
unconvolved neural prediction.</p>
<div class="nbplot container">
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#- Plot convolved neural prediction and unconvolved neural prediction</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">neural_prediction</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;unconvolved&#39;</span><span class="p">)</span>
<span class="go">[...]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hemodynamic_prediction</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;convolved&#39;</span><span class="p">)</span>
<span class="go">[...]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="go">&lt;...&gt;</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//hrf_correlation_solution-18.png">png</a>, <a class="reference external" href=".//hrf_correlation_solution-18.hires.png">hires.png</a>, <a class="reference external" href=".//hrf_correlation_solution-18.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/hrf_correlation_solution-18.png" src="_images/hrf_correlation_solution-18.png" />
</div>
</div>
<p>Does the new convolved time course correlate better with the voxel time
course?</p>
<div class="nbplot container">
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#- Correlation of the convolved time course with voxel time course</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">hemodynamic_prediction</span><span class="p">,</span> <span class="n">voxel_values</span><span class="p">)</span>
<span class="go">array([[ 1.    ,  0.3586],</span>
<span class="go">       [ 0.3586,  1.    ]])</span>
</pre></div>
</div>
</div>
<p>Plot the hemodynamic prediction against the actual signal (voxel values).
Remember to use a marker such as &#8216;+&#8217; to give you a scatter plot. How does it
look?</p>
<div class="nbplot container">
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#- Scatterplot the hemodynamic prediction against the signal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hemodynamic_prediction</span><span class="p">,</span> <span class="n">voxel_values</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span>
<span class="go">[...]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;hemodynamic prediction&#39;</span><span class="p">)</span>
<span class="go">&lt;...&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;voxel values&#39;</span><span class="p">)</span>
<span class="go">&lt;...&gt;</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//hrf_correlation_solution-20.png">png</a>, <a class="reference external" href=".//hrf_correlation_solution-20.hires.png">hires.png</a>, <a class="reference external" href=".//hrf_correlation_solution-20.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/hrf_correlation_solution-20.png" src="_images/hrf_correlation_solution-20.png" />
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">PSYCH 214 Fall 2016</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="syllabus.html">Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="preparation.html">Preparation</a></li>
<li class="toctree-l1"><a class="reference internal" href="logistics.html">Logistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="classes.html">Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="labs.html">Labs</a></li>
<li class="toctree-l1"><a class="reference internal" href="projects.html">Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="topics.html">Course material by topic</a></li>
<li class="toctree-l1"><a class="reference internal" href="exercises.html">Exercises and homework</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_data.html">Example datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="bibliography.html">Bibliography</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="_downloads">Website downloads</a></li>
    
    <li class="toctree-l1"><a href="https://nipy.bic.berkeley.edu/psych-214">Dataset downloads</a></li>
    
    <li class="toctree-l1"><a href="https://github.com/psych-214-fall-2016">Github organization</a></li>
    
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="hrf_correlation_exercise.html" title="previous chapter">Predicted neural time course exercise</a></li>
      <li>Next: <a href="non_tr_onsets.html" title="next chapter">Using onsets that do not start on a TR</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Matthew Brett, JB Poline.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="_sources/hrf_correlation_solution.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>