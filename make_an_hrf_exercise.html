<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Making our own hemodynamic response function &mdash; Functional MRI methods</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/copybutton.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Functional MRI methods" href="index.html" />
    <link rel="next" title="Making our own hemodynamic response function" href="make_an_hrf_solution.html" />
    <link rel="prev" title="Dummy coding GLM exercise" href="github_dummies_homework.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <p><span class="math">\(\newcommand{L}[1]{\| #1 \|}\newcommand{VL}[1]{\L{ \vec{#1} }}\newcommand{R}[1]{\operatorname{Re}\,(#1)}\newcommand{I}[1]{\operatorname{Im}\, (#1)}\)</span></p>
<div class="section" id="making-our-own-hemodynamic-response-function">
<h1>Making our own hemodynamic response function<a class="headerlink" href="#making-our-own-hemodynamic-response-function" title="Permalink to this headline">Â¶</a></h1>
<ul class="simple">
<li>For code template see: <a class="reference download internal" href="_downloads/make_an_hrf_code.py" download=""><code class="xref download docutils literal"><span class="pre">make_an_hrf_code.py</span></code></a>;</li>
<li>For solution see: <a class="reference internal" href="make_an_hrf_solution.html"><span class="doc">Making our own hemodynamic response function</span></a>.</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#: Import array and plotting libraries.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Print arrays to 4 decimal places</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The file <a class="reference download internal" href="_downloads/mt_hrf_estimates.txt" download=""><code class="xref download docutils literal"><span class="pre">mt_hrf_estimates.txt</span></code></a> contains the estimated FMRI signal
from voxels in the MT motion area at 0, 2, 4, ..., 28 seconds after a brief
moving visual stimulus (see:
<a class="reference external" href="http://nipy.org/nitime/examples/event_related_fmri.html">http://nipy.org/nitime/examples/event_related_fmri.html</a>).</p>
<p>Here are the first four rows. The numbers are in <a class="reference internal" href="floating_in_text.html"><span class="doc">exponential floating
point format</span></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="mf">1.394086932967517900e-01</span>
<span class="mf">3.938585701431884800e-01</span>
<span class="mf">5.012927230566770476e-01</span>
<span class="mf">5.676763716149294536e-01</span>
</pre></div>
</div>
<p>Read the values from the file into an array <code class="docutils literal"><span class="pre">mt_hrf_estimates</span></code>. Make a
new array <code class="docutils literal"><span class="pre">mt_hrf_times</span></code> with the times of acquisition (0, 2, ...).
Plot them together to see the HRF estimate at these times:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#- Load the estimated values from the text file into an array</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#- Make an array of corresponding times</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#- Plot signal by time</span>
</pre></div>
</div>
<p>We want to make a <em>hemodynamic response function</em> that matches this shape.</p>
<p>Our function will accept an array that gives the times we want to calculate
the HRF for, and returns the values of the HRF for those times. We will assume
that the true HRF starts at zero, and gets to zero sometime before 35 seconds.</p>
<p>Like SPM, I&#8217;m going to try using the sum of two <a class="reference external" href="https://en.wikipedia.org/wiki/Gamma_distribution">gamma
distribution</a>
probability density functions.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#: import the gamma density function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gamma</span>
</pre></div>
</div>
<p>Here&#8217;s my first shot:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#: my attempt - you can do better than this</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">not_great_hrf</span><span class="p">(</span><span class="n">times</span><span class="p">):</span>
<span class="gp">... </span>    <span class="sd">&quot;&quot;&quot; Return values for HRF at given times &quot;&quot;&quot;</span>
<span class="gp">... </span>    <span class="c1"># Gamma pdf for the peak</span>
<span class="gp">... </span>    <span class="n">peak_values</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="gp">... </span>    <span class="c1"># Gamma pdf for the undershoot</span>
<span class="gp">... </span>    <span class="n">undershoot_values</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="gp">... </span>    <span class="c1"># Combine them</span>
<span class="gp">... </span>    <span class="n">values</span> <span class="o">=</span> <span class="n">peak_values</span> <span class="o">-</span> <span class="mf">0.35</span> <span class="o">*</span> <span class="n">undershoot_values</span>
<span class="gp">... </span>    <span class="c1"># Scale max to 0.6</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">values</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.6</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#: plot the data against my estimate</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mt_hrf_times</span><span class="p">,</span> <span class="n">not_great_hrf</span><span class="p">(</span><span class="n">mt_hrf_times</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;not_great_hrf&#39;</span><span class="p">)</span>
<span class="go">[...]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mt_hrf_times</span><span class="p">,</span> <span class="n">mt_hrf_estimates</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mt_hrf_estimates&#39;</span><span class="p">)</span>
<span class="go">[...]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="go">&lt;...&gt;</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//make_an_hrf_exercise-7.png">png</a>, <a class="reference external" href=".//make_an_hrf_exercise-7.hires.png">hires.png</a>, <a class="reference external" href=".//make_an_hrf_exercise-7.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/make_an_hrf_exercise-7.png" src="_images/make_an_hrf_exercise-7.png" />
</div>
<p>Now see if you can make a better function by playing with the Gamma
distribution PDF parameter, and the mix of the two gamma distribution
functions. Call your function <code class="docutils literal"><span class="pre">mt_hrf</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#- Your &quot;mt_hrf&quot; function here</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#- Plot your function against the mt_hrf_estimates data to test</span>
</pre></div>
</div>
<p>For extra points - other than looking at these plots, how would you
convince me your function is better than mine?</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#- Evidence that your function is better than mine?</span>
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">PSYCH 214 Fall 2016</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="syllabus.html">Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="preparation.html">Preparation</a></li>
<li class="toctree-l1"><a class="reference internal" href="logistics.html">Logistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="classes.html">Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="labs.html">Labs</a></li>
<li class="toctree-l1"><a class="reference internal" href="projects.html">Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="topics.html">Course material by topic</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_data.html">Example datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="bibliography.html">Bibliography</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="_downloads">Website downloads</a></li>
    
    <li class="toctree-l1"><a href="https://nipy.bic.berkeley.edu/psych-214">Dataset downloads</a></li>
    
    <li class="toctree-l1"><a href="https://github.com/psych-214-fall-2016">Github organization</a></li>
    
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="github_dummies_homework.html" title="previous chapter">Dummy coding GLM exercise</a></li>
      <li>Next: <a href="make_an_hrf_solution.html" title="next chapter">Making our own hemodynamic response function</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Matthew Brett, JB Poline.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="_sources/make_an_hrf_exercise.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>