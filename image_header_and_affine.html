<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>The image header and affine &mdash; Functional MRI methods</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/copybutton.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Functional MRI methods" href="index.html" />
    <link rel="next" title="Rotation exercise" href="more_on_rotation_exercise.html" />
    <link rel="prev" title="Making floating points numbers print nicely" href="printing_floating.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <p><span class="math">\(\newcommand{L}[1]{\| #1 \|}\newcommand{VL}[1]{\L{ \vec{#1} }}\newcommand{R}[1]{\operatorname{Re}\,(#1)}\newcommand{I}[1]{\operatorname{Im}\, (#1)}\)</span></p>
<div class="section" id="the-image-header-and-affine">
<h1>The image header and affine<a class="headerlink" href="#the-image-header-and-affine" title="Permalink to this headline">¶</a></h1>
<p>See: <a class="reference external" href="http://nipy.org/nibabel/coordinate_systems.html">coordinate systems and affine transforms</a> for an introduction.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># import common modules</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># print arrays to 4DP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#: gray colormap and nearest neighbor interpolation by default</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;image.cmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;image.interpolation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;nearest&#39;</span>
</pre></div>
</div>
<div class="section" id="the-image-affine">
<h2>The image affine<a class="headerlink" href="#the-image-affine" title="Permalink to this headline">¶</a></h2>
<p>So far we have not paid much attention to the image <em>header</em>.  We first saw
the image header in <a class="reference internal" href="classwork/day_00/what_is_an_image.html"><span class="doc">What is an image?</span></a>.</p>
<p>From that exploration, we found that image consists of:</p>
<ul class="simple">
<li>the array data;</li>
<li>metadata (data about the array data).</li>
</ul>
<p>The header contains the metadata for the image.</p>
<p>One piece of metadata, is the image affine.  You can download the anatomical
image below from <a class="reference download internal" href="_downloads/ds107_sub012_highres.nii" download=""><code class="xref download docutils literal"><span class="pre">ds107_sub012_highres.nii</span></code></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">nibabel</span> <span class="kn">as</span> <span class="nn">nib</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;ds107_sub012_highres.nii&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">img</span><span class="o">.</span><span class="n">affine</span>
<span class="go">array([[   1.    ,    0.    ,    0.    , -127.    ],</span>
<span class="go">       [   0.    ,    1.    ,    0.    ,  -83.3253],</span>
<span class="go">       [   0.    ,    0.    ,    1.    ,  -90.0533],</span>
<span class="go">       [   0.    ,    0.    ,    0.    ,    1.    ]])</span>
</pre></div>
</div>
<p>As you can imagine, nibabel is getting the affine from the header:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
<span class="go">&lt;class &#39;nibabel.nifti1.Nifti1Header&#39;&gt; object, endian=&#39;&lt;&#39;</span>
<span class="go">sizeof_hdr      : 348</span>
<span class="go">data_type       : b&#39;&#39;</span>
<span class="go">db_name         : b&#39;&#39;</span>
<span class="go">extents         : 0</span>
<span class="go">session_error   : 0</span>
<span class="go">regular         : b&#39;r&#39;</span>
<span class="go">dim_info        : 0</span>
<span class="go">dim             : [  3 256 208 192   1   1   1   1]</span>
<span class="go">intent_p1       : 0.0</span>
<span class="go">intent_p2       : 0.0</span>
<span class="go">intent_p3       : 0.0</span>
<span class="go">intent_code     : none</span>
<span class="go">datatype        : int16</span>
<span class="go">bitpix          : 16</span>
<span class="go">slice_start     : 0</span>
<span class="go">pixdim          : [ 1.  1.  1.  1.  0.  0.  0.  0.]</span>
<span class="go">vox_offset      : 0.0</span>
<span class="go">scl_slope       : nan</span>
<span class="go">scl_inter       : nan</span>
<span class="go">slice_end       : 0</span>
<span class="go">slice_code      : unknown</span>
<span class="go">xyzt_units      : 10</span>
<span class="go">cal_max         : 0.0</span>
<span class="go">cal_min         : 0.0</span>
<span class="go">slice_duration  : 0.0</span>
<span class="go">toffset         : 0.0</span>
<span class="go">glmax           : 0</span>
<span class="go">glmin           : 0</span>
<span class="go">descrip         : b&#39;FSL4.0&#39;</span>
<span class="go">aux_file        : b&#39;&#39;</span>
<span class="go">qform_code      : scanner</span>
<span class="go">sform_code      : scanner</span>
<span class="go">quatern_b       : 0.0</span>
<span class="go">quatern_c       : 0.0</span>
<span class="go">quatern_d       : 0.0</span>
<span class="go">qoffset_x       : -127.0</span>
<span class="go">qoffset_y       : -83.32530212402344</span>
<span class="go">qoffset_z       : -90.05328369140625</span>
<span class="go">srow_x          : [   1.    0.    0. -127.]</span>
<span class="go">srow_y          : [  0.       1.       0.     -83.3253]</span>
<span class="go">srow_z          : [  0.       0.       1.     -90.0533]</span>
<span class="go">intent_name     : b&#39;&#39;</span>
<span class="go">magic           : b&#39;n+1&#39;</span>
</pre></div>
</div>
<p>Notice the <code class="docutils literal"><span class="pre">srow_x,</span> <span class="pre">srow_y,</span> <span class="pre">srow_z</span></code> fields in the header, that contain the
affine for this image. It is not always this simple though – see
<a class="reference external" href="http://nifti.nimh.nih.gov/nifti-1">http://nifti.nimh.nih.gov/nifti-1</a> for more details. In general, nibabel will
take care of this for you, by extracting the affine from the header, and
returning it via <code class="docutils literal"><span class="pre">img.affine</span></code>.</p>
</div>
<div class="section" id="nifti-images-can-also-be-img-hdr-pairs">
<h2>Nifti images can also be <code class="docutils literal"><span class="pre">.img,</span> <span class="pre">.hdr</span></code> pairs<a class="headerlink" href="#nifti-images-can-also-be-img-hdr-pairs" title="Permalink to this headline">¶</a></h2>
<p>So far, all the images we have seen have been NIfTI format images, stored in a
single file with a <code class="docutils literal"><span class="pre">.nii</span></code> extension. The single file contains the header
information, and the image array data.</p>
<p>The NIfTI format also allows the image to be stored as two files, one with
extension <code class="docutils literal"><span class="pre">.img</span></code> storing the image array data, and another with extension
<code class="docutils literal"><span class="pre">.hdr</span></code> storing the header. These are called <em>NIfTI pair</em> images.</p>
<p>For example, consider this pair of files –
<a class="reference download internal" href="_downloads/ds114_sub009_highres_moved.img" download=""><code class="xref download docutils literal"><span class="pre">ds114_sub009_highres_moved.img</span></code></a> and
<a class="reference download internal" href="_downloads/ds114_sub009_highres_moved.hdr" download=""><code class="xref download docutils literal"><span class="pre">ds114_sub009_highres_moved.hdr</span></code></a>. These two files together form one
NIfTI image. You can load these with nibabel in the usual way:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pair_img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;ds114_sub009_highres_moved.img&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pair_img</span><span class="o">.</span><span class="n">affine</span>
<span class="go">array([[   0.9416,   -0.4311,   -0.0586,  -98.8336],</span>
<span class="go">       [   0.336 ,    1.1887,    0.2264, -164.1377],</span>
<span class="go">       [  -0.0215,   -0.3028,    0.9723, -158.4178],</span>
<span class="go">       [   0.    ,    0.    ,    0.    ,    1.    ]])</span>
</pre></div>
</div>
<p>This form of the NIfTI image is getting less common, because it is
inconvenient to have to keep the <code class="docutils literal"><span class="pre">.img</span></code> and <code class="docutils literal"><span class="pre">.hdr</span></code> files together, but you
may still find them used. They have only one advantage, which is that, if some
software wants to change only the header information, it only has to rewrite a
small <code class="docutils literal"><span class="pre">.hdr</span></code> file, rather than the whole <code class="docutils literal"><span class="pre">.nii</span></code> file containing the image
data and the header.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">PSYCH 214 Fall 2016</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="syllabus.html">Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="preparation.html">Preparation</a></li>
<li class="toctree-l1"><a class="reference internal" href="logistics.html">Logistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="classes.html">Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="labs.html">Labs</a></li>
<li class="toctree-l1"><a class="reference internal" href="projects.html">Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="topics.html">Course material by topic</a></li>
<li class="toctree-l1"><a class="reference internal" href="exercises.html">Exercises and homework</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_data.html">Example datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="bibliography.html">Bibliography</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="_downloads">Website downloads</a></li>
    
    <li class="toctree-l1"><a href="https://nipy.bic.berkeley.edu/psych-214">Dataset downloads</a></li>
    
    <li class="toctree-l1"><a href="https://github.com/psych-214-fall-2016">Github organization</a></li>
    
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="printing_floating.html" title="previous chapter">Making floating points numbers print nicely</a></li>
      <li>Next: <a href="more_on_rotation_exercise.html" title="next chapter">Rotation exercise</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Matthew Brett, JB Poline.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="_sources/image_header_and_affine.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>